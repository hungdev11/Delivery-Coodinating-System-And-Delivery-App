server:
    port: 21501

spring:
    application:
        name: user-service
    datasource:
        url: jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${USER_DB_NAME:ds_user_service}?useUnicode=true&characterEncoding=utf8&useSSL=false&allowPublicKeyRetrieval=true&createDatabaseIfNotExist=true
        username: ${DB_USERNAME:root}
        password: ${DB_PASSWORD:root}
        driver-class-name: com.mysql.cj.jdbc.Driver
        # HikariCP Connection Pool Configuration
        hikari:
            maximum-pool-size: 20
            minimum-idle: 5
            connection-timeout: 30000
            idle-timeout: 600000
            max-lifetime: 1800000
            leak-detection-threshold: 60000
    jpa:
        hibernate:
            ddl-auto: ${JPA_DDL_AUTO:update} # Options: create, create-drop, update, validate, none
        show-sql: ${JPA_SHOW_SQL:false}
        properties:
            hibernate:
                format_sql: true
                # Auto-migration settings
                hbm2ddl:
                    auto: update
                # Generate DDL on startup
                generate_statistics: false
                # Better naming strategy
                naming:
                    physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
                # Additional migration settings
                jdbc:
                    batch_size: 20
                order_inserts: true
                order_updates: true
    # Disable Flyway - let Hibernate handle schema management
    flyway:
        enabled: false

    kafka:
        bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
        producer:
            key-serializer: org.apache.kafka.common.serialization.StringSerializer
            value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
            properties:
                'enable.idempotence': true

# Keycloak Configuration (from env.local)
keycloak:
    auth-server-url: ${KEYCLOAK_URL:https://keycloak.phuongy.works}
    realm: ${KEYCLOAK_REALM:delivery-system}
    resource: ${KEYCLOAK_CLIENT_ID:frontend-client}
    credentials:
        username: ${KEYCLOAK_ADMIN_USERNAME}
        password: ${KEYCLOAK_ADMIN_PASSWORD}
        secret: ${KEYCLOAK_CLIENT_SECRET:46sGOyba6nyt8UhLkKAQgzmbedF9L042}

    admin-client:
        # Connection pool settings (if needed by the HTTP client)
        connection-pool-size: 20
        # Timeout settings (in milliseconds)
        connection-timeout: 10000
        socket-timeout: 30000

    init:
        enabled: ${KEYCLOAK_INIT_ENABLED:true}
        master:
            realm: ${KEYCLOAK_MASTER_REALM:master}
            username: ${KEYCLOAK_ADMIN_USERNAME}
            password: ${KEYCLOAK_ADMIN_PASSWORD}
        default:
            realm: ${KEYCLOAK_DEFAULT_REALM:delivery-system}
            client-id: ${KEYCLOAK_DEFAULT_CLIENT_ID:frontend-client}

        realms:
            - name: delivery-system
              displayName: 'Delivery System'
              enabled: true
              roles:
                  - name: ADMIN
                    description: 'System administrator with full access'
                  - name: MANAGER
                    description: 'Manager with management access'
                  - name: STAFF
                    description: 'Staff member with operational access'
                  - name: SHIPPER
                    description: 'Delivery driver/shipper'
                  - name: SHOP
                    description: 'Shop/seller who creates delivery orders'
                  - name: CLIENT
                    description: 'End customer/client'

              clients:
                  - clientId: backend-client
                    name: 'Backend Control Client'
                    publicClient: false
                    serviceAccountsEnabled: true
                    standardFlowEnabled: true
                    directAccessGrantsEnabled: true
                    redirectUris: ['*']
                    webOrigins: ['*']
                    roles:
                        - admin-service
                        - management-service

                  - clientId: frontend-client
                    name: 'Frontend User Client'
                    secret: '' # Will be auto-generated
                    publicClient: false
                    serviceAccountsEnabled: false
                    standardFlowEnabled: true
                    directAccessGrantsEnabled: true
                    redirectUris:
                        - 'http://localhost:5173/*'
                        - 'http://localhost:3000/*'
                    webOrigins:
                        - 'http://localhost:5173'
                        - 'http://localhost:3000'
                    roles:
                        - user-service
                        - delivery-service

                  - clientId: dss-client
                    name: 'DSS Client'
                    secret: '' # Will be auto-generated
                    publicClient: false
                    serviceAccountsEnabled: true
                    standardFlowEnabled: true
                    directAccessGrantsEnabled: true
                    redirectUris: ['*']
                    webOrigins: ['*']
                    roles:
                        - admin-service
                        - management-service
                        - user-service
                        - delivery-service

              users:
                  - username: admin
                    email: admin@delivery-system.com
                    firstName: System
                    lastName: Administrator
                    password: admin123
                    enabled: true
                    emailVerified: true
                    realmRoles: [ADMIN]
                    clientRoles:
                        backend-client: [admin-service]

                  - username: manager
                    email: manager@delivery-system.com
                    firstName: Test
                    lastName: Manager
                    password: manager123
                    enabled: true
                    emailVerified: true
                    realmRoles: [MANAGER]
                    clientRoles:
                        backend-client: [management-service]

                  - username: staff
                    email: staff@delivery-system.com
                    firstName: Staff
                    lastName: Member
                    password: staff123
                    enabled: true
                    emailVerified: true
                    realmRoles: [STAFF]
                    clientRoles:
                        backend-client: [management-service]

                  - username: shipper01
                    email: shipper01@delivery-system.com
                    firstName: John
                    lastName: Shipper
                    password: shipper123
                    enabled: true
                    emailVerified: true
                    realmRoles: [SHIPPER]
                    clientRoles:
                        frontend-client: [delivery-service]
                    deliveryMan:
                        enabled: true
                        vehicleType: BIKE
                        capacityKg: 120

                  - username: shipper02
                    email: shipper02@delivery-system.com
                    firstName: Minh
                    lastName: Tran
                    password: shipper123
                    enabled: true
                    emailVerified: true
                    realmRoles: [SHIPPER]
                    clientRoles:
                        frontend-client: [delivery-service]
                    deliveryMan:
                        enabled: true
                        vehicleType: BIKE
                        capacityKg: 150

                  - username: shipper03
                    email: shipper03@delivery-system.com
                    firstName: Hung
                    lastName: Nguyen
                    password: shipper123
                    enabled: true
                    emailVerified: true
                    realmRoles: [SHIPPER]
                    clientRoles:
                        frontend-client: [delivery-service]
                    deliveryMan:
                        enabled: true
                        vehicleType: BIKE
                        capacityKg: 80

                  - username: shipper04
                    email: shipper04@delivery-system.com
                    firstName: Lan
                    lastName: Le
                    password: shipper123
                    enabled: true
                    emailVerified: true
                    realmRoles: [SHIPPER]
                    clientRoles:
                        frontend-client: [delivery-service]
                    deliveryMan:
                        enabled: true
                        vehicleType: CAR
                        capacityKg: 120

                  - username: shipper05
                    email: shipper05@delivery-system.com
                    firstName: Duc
                    lastName: Pham
                    password: shipper123
                    enabled: true
                    emailVerified: true
                    realmRoles: [SHIPPER]
                    clientRoles:
                        frontend-client: [delivery-service]
                    deliveryMan:
                        enabled: true
                        vehicleType: CAR
                        capacityKg: 200

                  - username: shop01
                    email: shop01@delivery-system.com
                    firstName: My
                    lastName: Shop
                    password: shop123
                    enabled: true
                    emailVerified: true
                    realmRoles: [SHOP]
                    clientRoles:
                        frontend-client: [user-service]
                    address:
                        name: My Shop - Primary Address
                        addressText: 123 Nguyen Hue Street, District 1, Ho Chi Minh City
                        lat: 10.762622
                        lon: 106.660172

                  - username: shop02
                    email: shop02@delivery-system.com
                    firstName: Fast
                    lastName: Mart
                    password: shop123
                    enabled: true
                    emailVerified: true
                    realmRoles: [SHOP]
                    clientRoles:
                        frontend-client: [user-service]
                    address:
                        name: Fast Mart - Primary Address
                        addressText: 456 Le Loi Street, District 1, Ho Chi Minh City
                        lat: 10.770000
                        lon: 106.670000

                  - username: shop03
                    email: shop03@delivery-system.com
                    firstName: Quick
                    lastName: Store
                    password: shop123
                    enabled: true
                    emailVerified: true
                    realmRoles: [SHOP]
                    clientRoles:
                        frontend-client: [user-service]
                    address:
                        name: Quick Store - Primary Address
                        addressText: 789 Dong Khoi Street, District 1, Ho Chi Minh City
                        lat: 10.775000
                        lon: 106.675000

                  - username: shop04
                    email: shop04@delivery-system.com
                    firstName: Best
                    lastName: Shop
                    password: shop123
                    enabled: true
                    emailVerified: true
                    realmRoles: [SHOP]
                    clientRoles:
                        frontend-client: [user-service]
                    address:
                        name: Best Shop - Primary Address
                        addressText: 321 Pasteur Street, District 3, Ho Chi Minh City
                        lat: 10.785000
                        lon: 106.685000

                  - username: shop05
                    email: shop05@delivery-system.com
                    firstName: Mega
                    lastName: Market
                    password: shop123
                    enabled: true
                    emailVerified: true
                    realmRoles: [SHOP]
                    clientRoles:
                        frontend-client: [user-service]
                    address:
                        name: Mega Market - Primary Address
                        addressText: 654 Vo Van Tan Street, District 3, Ho Chi Minh City
                        lat: 10.790000
                        lon: 106.690000

                  - username: staff02
                    email: staff02@delivery-system.com
                    firstName: Staff
                    lastName: Two
                    password: staff123
                    enabled: true
                    emailVerified: true
                    realmRoles: [STAFF]
                    clientRoles:
                        backend-client: [management-service]

                  - username: client01
                    email: client01@delivery-system.com
                    firstName: Jane
                    lastName: Customer
                    password: client123
                    enabled: true
                    emailVerified: true
                    realmRoles: [CLIENT]
                    clientRoles:
                        frontend-client: [user-service]
                    address:
                        name: Jane Customer - Primary Address
                        addressText: Đại học Sư phạm Kỹ thuật TP.HCM, Võ Văn Ngân, Linh Chiểu, Thủ Đức, TP.HCM
                        lat: 10.860000
                        lon: 106.770000

                  - username: client02
                    email: client02@delivery-system.com
                    firstName: Minh
                    lastName: Le
                    password: client123
                    enabled: true
                    emailVerified: true
                    realmRoles: [CLIENT]
                    clientRoles:
                        frontend-client: [user-service]
                    address:
                        name: Minh Le - Primary Address
                        addressText: 123 Lê Văn Việt, Bình Thọ, Thủ Đức, TP.HCM
                        lat: 10.850000
                        lon: 106.760000

                  - username: client03
                    email: client03@delivery-system.com
                    firstName: Lan
                    lastName: Tran
                    password: client123
                    enabled: true
                    emailVerified: true
                    realmRoles: [CLIENT]
                    clientRoles:
                        frontend-client: [user-service]
                    address:
                        name: Lan Tran - Primary Address
                        addressText: 456 Võ Văn Ngân, Bình Thọ, Thủ Đức, TP.HCM
                        lat: 10.862000
                        lon: 106.772000

                  - username: client04
                    email: client04@delivery-system.com
                    firstName: Duc
                    lastName: Nguyen
                    password: client123
                    enabled: true
                    emailVerified: true
                    realmRoles: [CLIENT]
                    clientRoles:
                        frontend-client: [user-service]
                    address:
                        name: Duc Nguyen - Primary Address
                        addressText: Đường Huy Cận, Phường Phước Long, Thủ Đức, TP.HCM
                        lat: 10.830000
                        lon: 106.750000

                  - username: client05
                    email: client05@delivery-system.com
                    firstName: An
                    lastName: Pham
                    password: client123
                    enabled: true
                    emailVerified: true
                    realmRoles: [CLIENT]
                    clientRoles:
                        frontend-client: [user-service]
                    address:
                        name: An Pham - Primary Address
                        addressText: 789 Lê Văn Việt, Hiệp Phú, Thủ Đức, TP.HCM
                        lat: 10.848000
                        lon: 106.758000

                  - username: client06
                    email: client06@delivery-system.com
                    firstName: Hoa
                    lastName: Vo
                    password: client123
                    enabled: true
                    emailVerified: true
                    realmRoles: [CLIENT]
                    clientRoles:
                        frontend-client: [user-service]
                    address:
                        name: Hoa Vo - Primary Address
                        addressText: 321 Võ Văn Ngân, Linh Chiểu, Thủ Đức, TP.HCM
                        lat: 10.864000
                        lon: 106.774000

                  - username: client07
                    email: client07@delivery-system.com
                    firstName: Hung
                    lastName: Hoang
                    password: client123
                    enabled: true
                    emailVerified: true
                    realmRoles: [CLIENT]
                    clientRoles:
                        frontend-client: [user-service]
                    address:
                        name: Hung Hoang - Primary Address
                        addressText: 654 Lê Văn Việt, Tăng Nhơn Phú A, Thủ Đức, TP.HCM
                        lat: 10.852000
                        lon: 106.762000

# External Services
services:
    settings:
        base-url: ${SETTINGS_SERVICE_URL:http://localhost:21502}
    zone:
        base-url: ${ZONE_SERVICE_URL:http://localhost:21503}
    parcel:
        base-url: ${PARCEL_SERVICE_URL:http://localhost:21506}

# Parcel Seed Configuration
parcel:
    seed:
        enabled: ${PARCEL_SEED_ENABLED:true}
        count: ${PARCEL_SEED_COUNT:20}

# Actuator Configuration
management:
    endpoints:
        web:
            exposure:
                include: health,info
            base-path: /actuator
    endpoint:
        health:
            show-details: always

# User Service Settings
user:
    settings:
        service:
            max-retries: 10
            retry-delay-seconds: 10

# Logging Configuration
logging:
    pattern:
        console: '%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n'
    level:
        root: ERROR
        com.ds.user: DEBUG
        com.ds: DEBUG
        org.springframework: ERROR
        org.springframework.web: ERROR
        org.springframework.boot: ERROR
        org.springframework.context: ERROR
        org.springframework.beans: ERROR
        org.springframework.core: ERROR
        org.springframework.security: ERROR
        org.hibernate: ERROR
        org.hibernate.SQL: OFF
        org.hibernate.type.descriptor.sql: OFF
        org.flywaydb: ERROR
        com.zaxxer.hikari: ERROR
        org.keycloak: ERROR
        org.jboss.resteasy: ERROR
        org.apache.http: ERROR
        org.apache.catalina: ERROR
        org.apache.tomcat: ERROR
        org.jboss.resteasy.client: ERROR
        com.fasterxml.jackson: ERROR
        org.reflections: ERROR
        io.netty: ERROR
        reactor.netty: ERROR
        ch.qos.logback: ERROR
        org.apache.kafka: ERROR
