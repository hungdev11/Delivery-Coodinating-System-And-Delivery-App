server:
    port: 21506

spring:
    application:
        name: parcel-service
    datasource:
        url: jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${PARCEL_DB_NAME:ds_parcel_service}?useUnicode=true&characterEncoding=utf8&useSSL=false&allowPublicKeyRetrieval=true&createDatabaseIfNotExist=true
        username: ${DB_USERNAME:root}
        password: ${DB_PASSWORD:root}
        driver-class-name: com.mysql.cj.jdbc.Driver
        # HikariCP Connection Pool Configuration
        hikari:
            maximum-pool-size: 20
            minimum-idle: 5
            connection-timeout: 30000
            idle-timeout: 600000
            max-lifetime: 1800000
            leak-detection-threshold: 60000
    jpa:
        hibernate:
            ddl-auto: update
        show-sql: false
        properties:
            hibernate:
                format_sql: true

    kafka:
        bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
        consumer:
            group-id: ${KAFKA_CONSUMER_GROUP:parcel-service-group}
            auto-offset-reset: earliest
            key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
            value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
            properties:
                spring.json.trusted.packages: com.ds
            enable-auto-commit: false
        producer:
            key-serializer: org.apache.kafka.common.serialization.StringSerializer
            value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
            properties:
                'enable.idempotence': true
            # transaction-id-prefix removed - not using transactions
        template:
            default-topic: parcel-status-request
        listener:
            ack-mode: manual
            missing-topics-fatal: false
        # Removed isolation.level - not using transactions

logging:
    pattern:
        console: '%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n'
    level:
        root: ERROR
        com.ds.parcel_service: DEBUG
        org.springframework: ERROR
        org.springframework.web: ERROR
        org.springframework.boot: ERROR
        org.springframework.security: ERROR
        org.hibernate: ERROR
        org.hibernate.SQL: ERROR
        com.zaxxer.hikari: ERROR
        org.apache.kafka: ERROR
        feign: ERROR

# Actuator Configuration
management:
    endpoints:
        web:
            exposure:
                include: health,info
            base-path: /actuator
    endpoint:
        health:
            show-details: always

# Feign Client Configuration
feign:
    client:
        config:
            default:
                connectTimeout: 5000
                readTimeout: 10000
                loggerLevel: basic
            zone-service:
                connectTimeout: 5000
                readTimeout: 10000
    httpclient:
        connection-timeout: 5000
        time-to-live: 30000
        max-connections: 200
        max-connections-per-route: 50

# External Services Configuration
services:
    zone:
        base-url: ${ZONE_SERVICE_URL:http://zone-service:21503}
    session:
        base-url: ${SESSION_SERVICE_URL:http://session-service:21505}
    user:
        base-url: ${USER_SERVICE_URL:http://user-service:21501}
