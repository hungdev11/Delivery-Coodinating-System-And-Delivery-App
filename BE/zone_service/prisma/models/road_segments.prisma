// Road segments (arcs) between nodes - the core routing unit
model road_segments {
  segment_id String  @id @default(uuid())
  osm_way_id BigInt? // OSM way ID for mapping

  // Connection between two nodes
  from_node_id String
  to_node_id   String
  from_node    road_nodes @relation("SegmentFromNode", fields: [from_node_id], references: [node_id])
  to_node      road_nodes @relation("SegmentToNode", fields: [to_node_id], references: [node_id])

  // Parent road (inherits properties)
  road_id String
  road    roads  @relation(fields: [road_id], references: [road_id])

  // Segment geometry
  geometry      Json // GeoJSON LineString for this segment
  geom          Unsupported("geometry")?
  length_meters Float // Physical length in meters

  // Inherited properties from parent road
  name      String
  road_type RoadType
  max_speed Float? // km/h
  avg_speed Float? // km/h
  one_way   Boolean  @default(false)

  // Weight calculation (for routing)
  base_weight    Float // Calculated from length, speed, road_type (static)
  current_weight Float // base_weight + delta_weight (updated periodically)
  delta_weight   Float @default(0) // Dynamic adjustment based on traffic

  // Zone association
  zone_id String?
  zones   zones?  @relation(fields: [zone_id], references: [zone_id])

  // Related data
  addresses          addresses[]
  traffic_conditions traffic_conditions[]
  user_feedback      user_feedback[]
  road_overrides     road_overrides[]

  // Metadata
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt
  weight_updated_at DateTime @default(now()) // Last time weights were recalculated

  @@index([from_node_id])
  @@index([to_node_id])
  @@index([road_id])
  @@index([zone_id])
  @@index([current_weight])
  @@index([osm_way_id])
}

// Note: RoadType enum is already defined in roads.prisma
